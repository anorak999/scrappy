# Scrappy - One-Click Web Scraper

<p align="center">
  <img src="assets/icons/icon128.png" alt="Scrappy Logo" width="128">
</p>

<p align="center">
  <strong>Capture entire web pages locally with a single click</strong>
</p>

---

## Table of Contents

- [Features](#features)
- [Installation](#installation)
- [Usage](#usage)
- [Export Formats](#export-formats)
- [Architecture](#architecture)
- [Configuration](#configuration)
- [Development](#development)
- [Testing](#testing)
- [Deployment](#deployment)
- [Legal & Ethics](#legal--ethics)
- [Troubleshooting](#troubleshooting)
- [Contributing](#contributing)
- [License](#license)

---

## Features

### Core Capabilities

- **One-Click Capture**: Single button to scrape the entire current page
- **Multiple Export Formats**: HTML, MHTML, PDF, and ZIP archive
- **Resource Inlining**: Automatically fetches and embeds CSS, JavaScript, images, and fonts
- **Dynamic Content Handling**: Captures rendered DOM including lazy-loaded content
- **Offline Viewing**: Creates self-contained files that work without internet

### Advanced Features

- **Smart Caching**: Memoization prevents redundant resource fetching
- **Fault Tolerance**: Circuit breakers protect against cascading failures
- **Error Logging**: Dead Letter Queue captures and logs errors for debugging
- **Idempotent Operations**: Consistent results for repeated captures
- **Progress Tracking**: Real-time progress updates during capture

### Technical Highlights

- Manifest V3 compliant
- Pure functional programming patterns
- Hexagonal (Ports & Adapters) architecture
- Monadic error handling with Result types
- Immutable data structures throughout

---

## Installation

### From Chrome Web Store (Coming Soon)

1. Visit the Chrome Web Store
2. Search for "Scrappy Web Scraper"
3. Click "Add to Chrome"

### Developer Installation (Unpacked)

1. **Clone or Download**
   ```bash
   git clone https://github.com/anorak-999/scrappy.git
   cd scrappy
   ```

2. **Generate Icons** (Optional - placeholder icons included)
   ```bash
   cd assets/icons
   ./generate-icons.sh
   ```

3. **Load in Chrome**
   - Open Chrome and navigate to `chrome://extensions/`
   - Enable "Developer mode" (toggle in top-right)
   - Click "Load unpacked"
   - Select the `scrappy` folder

4. **Verify Installation**
   - You should see the Scrappy icon in your toolbar
   - Click it to open the popup

---

## Usage

### Basic Usage

1. Navigate to any web page you want to capture
2. Click the Scrappy icon in your browser toolbar
3. Select your preferred export format (HTML, MHTML, ZIP, PDF)
4. Click "Capture Page"
5. Wait for the capture to complete
6. Choose where to save the file

### Format Selection

| Format | Best For |
|--------|----------|
| **HTML** | Single file, maximum compatibility |
| **MHTML** | Email/archive, preserves structure |
| **ZIP** | Separate assets, easy to edit |
| **PDF** | Printing, sharing, fixed layout |

### Settings

Click the gear icon (⚙️) to access settings:

- **Inline external resources**: Embed CSS/JS/images directly
- **Include JavaScript**: Preserve page scripts
- **Include Stylesheets**: Preserve page styling
- **Resource Timeout**: How long to wait for each resource
- **Max Resource Size**: Skip resources larger than this

---

## Export Formats

### HTML (Self-Contained)

Creates a single `.html` file with all resources embedded as data URIs.

**Pros:**
- Maximum portability
- Works in any browser
- Single file, easy to share

**Cons:**
- Larger file size
- No editable assets

### MHTML (Web Archive)

Creates a `.mhtml` file in MIME format (same as "Save as MHTML" in browsers).

**Pros:**
- Standard archive format
- Preserves original structure
- Smaller than HTML with data URIs

**Cons:**
- Limited browser support
- Complex internal structure

### ZIP Archive

Creates a `.zip` file containing `index.html` and separate asset files.

**Pros:**
- Assets are editable
- Smaller total size
- Easy to inspect/modify

**Cons:**
- Multiple files to manage
- Requires extraction

### PDF Document

Creates a `.pdf` file using Chrome's print engine.

**Pros:**
- Universal format
- Print-ready
- Fixed layout

**Cons:**
- Not editable
- May lose interactivity
- Page breaks may be unexpected

---

## Architecture

### Hexagonal Architecture (Ports & Adapters)

```
┌─────────────────────────────────────────────────────────────────┐
│                         POPUP (UI Layer)                        │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐ │
│  │ popup.html  │  │ popup.css   │  │      popup.js           │ │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘ │
└───────────────────────────┬─────────────────────────────────────┘
                            │ Messages
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                   SERVICE WORKER (Application Layer)            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              service-worker.js                           │   │
│  │  • Message routing                                       │   │
│  │  • Job orchestration                                     │   │
│  │  • Settings management                                   │   │
│  └─────────────────────────────────────────────────────────┘   │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                      CORE (Domain Layer)                        │
│  ┌─────────────┐  ┌─────────────────┐  ┌────────────────────┐  │
│  │   types.js  │  │ html-processor  │  │ resource-fetcher   │  │
│  │  • Result   │  │ • DOM parsing   │  │ • Fetch resources  │  │
│  │  • Option   │  │ • URL extract   │  │ • Circuit breaker  │  │
│  │  • PageData │  │ • Inlining      │  │ • Memoization      │  │
│  └─────────────┘  └─────────────────┘  └────────────────────┘  │
│  ┌─────────────┐  ┌─────────────────┐  ┌────────────────────┐  │
│  │  memoize.js │  │ circuit-breaker │  │ dead-letter-queue  │  │
│  └─────────────┘  └─────────────────┘  └────────────────────┘  │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                    EXPORTERS (Adapter Layer)                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────┐  ┌───────────┐  │
│  │ html-export │  │ mhtml-export│  │zip-export│ │ pdf-export│  │
│  └─────────────┘  └─────────────┘  └─────────┘  └───────────┘  │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                  CONTENT SCRIPT (Page Context)                  │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              content-script.js                           │   │
│  │  • DOM serialization                                     │   │
│  │  • Lazy image expansion                                  │   │
│  │  • Shadow DOM handling                                   │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### Engineering Principles Applied

| Principle | Implementation |
|-----------|----------------|
| **SSOT** | Single `PageData` object holds all scraped content |
| **SoC** | UI, core logic, and exporters are completely separate |
| **Composition** | Exporters are composed independently |
| **Immutability** | All data structures are frozen after creation |
| **Pure Functions** | Core processing functions have no side effects |
| **Fail-Fast** | Validation at boundaries, immediate error reporting |

### Engineering Patterns

| Pattern | Purpose |
|---------|---------|
| **Result Monad** | Type-safe error handling without exceptions |
| **Circuit Breaker** | Prevents cascading failures when fetching resources |
| **Memoization** | Caches expensive operations (checksums, resources) |
| **Dead Letter Queue** | Captures and logs unprocessable operations |
| **Higher-Order Functions** | Composition of processing pipelines |

---

## Configuration

### Default Settings

```javascript
{
  format: 'html',
  inlineResources: true,
  includeScripts: true,
  includeStyles: true,
  resourceTimeout: 10000,     // 10 seconds
  maxResourceSize: 5242880,   // 5 MB
  excludePatterns: [
    '*analytics*',
    '*tracking*',
    '*advertisement*'
  ]
}
```

### Exclude Patterns

You can customize which resources to exclude using glob patterns:

```javascript
excludePatterns: [
  '*analytics*',        // Skip analytics scripts
  '*tracking*',         // Skip tracking pixels
  '*advertisement*',    // Skip ads
  '*.min.js',          // Skip minified JS (optional)
]
```

---

## Development

### Project Structure

```
scrappy/
├── manifest.json           # Extension manifest
├── background/
│   └── service-worker.js   # Background service worker
├── content/
│   └── content-script.js   # Content script for DOM access
├── popup/
│   ├── popup.html         # Popup UI
│   ├── popup.css          # Popup styles
│   └── popup.js           # Popup logic
├── core/
│   ├── types.js           # Core types and Result monad
│   ├── memoize.js         # Memoization utilities
│   ├── circuit-breaker.js # Circuit breaker pattern
│   ├── dead-letter-queue.js # Error logging
│   ├── utils.js           # Functional utilities
│   ├── resource-fetcher.js # Resource fetching
│   └── html-processor.js  # HTML processing
├── exporters/
│   ├── exporter-interface.js # Exporter port interface
│   ├── html-exporter.js   # HTML format
│   ├── mhtml-exporter.js  # MHTML format
│   ├── zip-exporter.js    # ZIP format
│   ├── pdf-exporter.js    # PDF format
│   └── index.js           # Exporter registry
├── assets/
│   └── icons/             # Extension icons
├── tests/
│   └── scrappy.test.js    # Test specifications
└── README.md
```

### Adding a New Exporter

1. Create new file in `exporters/`:

```javascript
// exporters/custom-exporter.js
import { registerExporter } from './exporter-interface.js';

const customExporter = {
  format: 'custom',
  extension: '.custom',
  mimeType: 'application/x-custom',
  label: 'Custom Format',
  description: 'My custom export format',

  export: async (pageData, options = {}) => {
    // Transform pageData to your format
    const content = /* ... */;
    const blob = new Blob([content], { type: 'application/x-custom' });
    
    return {
      blob,
      filename: `${pageData.title}.custom`,
      mimeType: 'application/x-custom',
      size: blob.size,
    };
  },
};

registerExporter(customExporter);
export default customExporter;
```

2. Import in `exporters/index.js`:

```javascript
import './custom-exporter.js';
```

3. The new format will automatically appear in the UI.

---

## Testing

### Running Tests

```bash
# Install Jest
npm install --save-dev jest

# Run all tests
npm test

# Run with coverage
npm test -- --coverage

# Run specific test file
npm test -- tests/scrappy.test.js

# Watch mode
npm test -- --watch
```

### Test Categories

| Category | Description |
|----------|-------------|
| **Unit Tests** | Test individual functions in isolation |
| **Integration Tests** | Test component interactions |
| **Edge Cases** | Test boundary conditions and error handling |
| **Idempotency Tests** | Verify consistent results on repeated runs |

### Manual Testing Checklist

- [ ] Capture simple static HTML page
- [ ] Capture page with external CSS
- [ ] Capture page with images
- [ ] Capture page with lazy-loaded content
- [ ] Test all four export formats
- [ ] Verify offline viewing works
- [ ] Test with large pages (>10MB)
- [ ] Test with pages that have CORS restrictions
- [ ] Test settings persistence
- [ ] Test error handling for unreachable resources

---

## Deployment

### Building for Production

1. **Update Version**
   ```json
   // manifest.json
   "version": "1.0.1"
   ```

2. **Generate Production Icons**
   - Create high-quality icons at 16, 32, 48, 128 pixels
   - Use the provided SVG as a template

3. **Create ZIP for Chrome Web Store**
   ```bash
   zip -r scrappy-v1.0.1.zip . \
     -x "*.git*" \
     -x "node_modules/*" \
     -x "tests/*" \
     -x "*.md" \
     -x "package*.json"
   ```

4. **Submit to Chrome Web Store**
   - Go to [Chrome Web Store Developer Dashboard](https://chrome.google.com/webstore/devconsole)
   - Click "New Item"
   - Upload the ZIP file
   - Fill in listing details
   - Submit for review

### Permissions Justification

| Permission | Reason |
|------------|--------|
| `activeTab` | Access current tab content for capture |
| `scripting` | Inject content script for DOM serialization |
| `storage` | Persist user preferences |
| `downloads` | Save captured files |
| `notifications` | Notify user when capture completes |
| `<all_urls>` | Fetch external resources from any domain |

---

## Legal & Ethics

### ⚠️ Important Disclaimer

**Scrappy is intended for personal, educational, and legitimate archival purposes only.**

By using this extension, you agree to:

1. **Respect Copyright**: Do not use to copy copyrighted content for redistribution
2. **Follow Terms of Service**: Obey website terms regarding scraping/copying
3. **Obtain Permission**: Get consent before scraping private or protected content
4. **Respect Robots.txt**: Honor website scraping policies
5. **Legal Compliance**: Ensure your use complies with local laws

### What You CAN Do

✅ Save articles for offline reading  
✅ Archive your own content  
✅ Create backups of public pages  
✅ Research and education  
✅ Accessibility improvements  

### What You Should NOT Do

❌ Mass scraping for commercial purposes  
❌ Copying copyrighted content for redistribution  
❌ Bypassing paywalls or login requirements  
❌ Scraping personal data without consent  
❌ Violating website terms of service  

---

## Troubleshooting

### Common Issues

**"Cannot capture this page"**
- The extension cannot capture browser internal pages (`chrome://`, `about:`, etc.)
- Try on a regular website instead

**Capture seems stuck**
- Some pages have many resources that take time to fetch
- Check if the page has many large images
- Try reducing the resource timeout in settings

**Missing images in captured file**
- CORS restrictions may prevent fetching some resources
- The resource may have exceeded the size limit
- Check the developer console for errors

**PDF looks different from the page**
- PDF uses the print stylesheet
- Some dynamic content may not render
- Try HTML format for better fidelity

**ZIP file has broken links**
- Some resources may have failed to fetch
- Check the manifest.json inside the ZIP for details

### Debug Mode

To enable verbose logging:

1. Right-click the Scrappy icon → "Manage Extension"
2. Click "service worker" to open DevTools
3. View console for detailed logs

### Reporting Issues

Please include:
- Chrome version
- Extension version
- URL (if not private)
- Expected vs actual behavior
- Console errors (if any)

---

## Contributing

### Development Setup

```bash
# Clone repository
git clone https://github.com/anorak-999/scrappy.git
cd scrappy

# Install dependencies
npm install

# Run tests
npm test

# Load extension in Chrome
# (See Installation section)
```

### Code Style

- Use ES6+ features
- Follow functional programming patterns
- Prefer pure functions over side effects
- Use meaningful variable names
- Add JSDoc comments for public functions

### Pull Request Process

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

---

## License

MIT License

Copyright (c) 2026 anoraK

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

---

<p align="center">
  Made with ❤️ by <a href="https://x.com/anoraK_999">@anoraK_999</a>
</p>
